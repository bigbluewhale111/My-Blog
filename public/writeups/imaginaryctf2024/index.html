<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>ImaginaryCTF 2024 | My New Hugo Site</title>
<meta name="keywords" content="">
<meta name="description" content="TL;DR
This is a writeup for some web challenge for ImaginaryCTF 2024
Readme
Well, simply read the Dockerfile and got the flag.
That was the unintended way, the authentic way was bypass the $request_filename. So if we make request GET /flag.txt directly, nginx will recognize the $request_filename. So if we make request GET /flag.txt/., then nginx will treat this as a path and NodeJS will resolve the file and we will get the flag.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/writeups/imaginaryctf2024/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.9de45e225101e4f99701d2b68fc6b8a1ef6027928be6391fa15bf7f56326c909.css" integrity="sha256-neReIlEB5PmXAdK2j8a4oe9gJ5KL5jkfoVv39WMmyQk=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/writeups/imaginaryctf2024/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="My New Hugo Site (Alt + H)">My New Hugo Site</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/blogs/" title="Blogs">
                    <span>Blogs</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/writeups/" title="Writeups">
                    <span>Writeups</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a></div>
    <h1 class="post-title entry-hint-parent">
      ImaginaryCTF 2024
    </h1>
    <div class="post-meta"><span title='2025-02-05 15:16:21 +0700 +07'>February 5, 2025</span>&nbsp;Â·&nbsp;4 min

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#tldr" aria-label="TL;DR">TL;DR</a></li>
                <li>
                    <a href="#readme" aria-label="Readme">Readme</a></li>
                <li>
                    <a href="#journal" aria-label="Journal">Journal</a></li>
                <li>
                    <a href="#p2c" aria-label="P2C">P2C</a></li>
                <li>
                    <a href="#crystals" aria-label="Crystals">Crystals</a></li>
                <li>
                    <a href="#the-amazing-race" aria-label="The Amazing Race">The Amazing Race</a></li>
                <li>
                    <a href="#readme2" aria-label="Readme2">Readme2</a></li>
                <li>
                    <a href="#pwning-en-logique" aria-label="Pwning en Logique">Pwning en Logique</a></li>
                <li>
                    <a href="#notactf" aria-label="Notactf">Notactf</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="tldr">TL;DR<a hidden class="anchor" aria-hidden="true" href="#tldr">#</a></h2>
<p>This is a writeup for some web challenge for ImaginaryCTF 2024</p>
<h2 id="readme">Readme<a hidden class="anchor" aria-hidden="true" href="#readme">#</a></h2>
<p>Well, simply read the Dockerfile and got the flag.
That was the unintended way, the authentic way was bypass the $request_filename. So if we make request GET /flag.txt directly, nginx will recognize the $request_filename. So if we make request GET /flag.txt/., then nginx will treat this as a path and NodeJS will resolve the file and we will get the flag.</p>
<h2 id="journal">Journal<a hidden class="anchor" aria-hidden="true" href="#journal">#</a></h2>
<p>As the description said: &ldquo;there is no LFI in the app&rdquo;. So how can we read the flag? There is a way to RCE in PHP if assert not handled carefully.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">assert</span>(<span style="color:#e6db74">&#34;strpos(&#39;</span><span style="color:#e6db74">$file</span><span style="color:#e6db74">&#39;, &#39;..&#39;) === false&#34;</span>) <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;Invalid file!&#34;</span>);
</span></span></code></pre></div><p>In this case, a <code>GET /?file=a%27,die(`cat+/flag*`));</code> would give us the flag.</p>
<h2 id="p2c">P2C<a hidden class="anchor" aria-hidden="true" href="#p2c">#</a></h2>
<p>I was too lazy to think of any other ways to solve this challenge. I just used generated Python reverse shell.</p>
<h2 id="crystals">Crystals<a hidden class="anchor" aria-hidden="true" href="#crystals">#</a></h2>
<p>This was a fun one, while I was really confused about the challenge source, I just tested a payload <code>GET/`ls` </code> and got the flag.</p>
<h2 id="the-amazing-race">The Amazing Race<a hidden class="anchor" aria-hidden="true" href="#the-amazing-race">#</a></h2>
<p>At first glance, I guessed this challenge would be a race condition one. The challenge check whether we can move if the wall is not next to the Player. So if we spam many request, we would be able to reach the goal. Let&rsquo;s explain this idea. So if the first and second request were sent to the server at roughly same time, first request passed the movement check, but hadn&rsquo;t moved yet, so the second request would pass the check also. So we can move through wall. I used Burpsuit Turbo Intruder to solve this.</p>
<h2 id="readme2">Readme2<a hidden class="anchor" aria-hidden="true" href="#readme2">#</a></h2>
<p>Well this is a guessy one. While trying stupid payload I tried <code>GET /\\0</code> and the debugging show that it tried resolving 0.0.0.0, then I tried <code>GET //0</code> and get the same thing. So why? As I test out the <code>URL('http://a.test/hehe', 'http://b.test')</code>, this would not return <code>http://b.test/http://a.test/hehe</code> or anything like b.test host. It returned the host of the first parameter. So when I tried <code>GET //0</code> the new <code>URL(url.pathname + url.search, 'http://localhost:3000/')</code> would return <code>http://0.0.0.0</code> (because Javascript treat <code>//something</code> as <code>http://something</code> ). So this was a SSRF. I made an endpoint to redirect to <code>http://localhost:3000/flag.txt</code> and made request to my endpoint and get the flag.
This was unintended though, the intended one was exploiting the fact that &ldquo;Bun will put the value of <code>Host</code> header into <code>req.url</code>, which allows us to do many funny things to bypass the check.&rdquo; - <a href="https://github.com/ImaginaryCTF/ImaginaryCTF-2024-Challenges-Public/blob/main/Web/readme2/README.md">Original Writeup</a>.</p>
<h2 id="pwning-en-logique">Pwning en Logique<a hidden class="anchor" aria-hidden="true" href="#pwning-en-logique">#</a></h2>
<p>I think this chall was some sort of SSTI. After reading the document carefully, I saw that <code>~@</code> would execute the next argument and the output will be placed there. The downside is the next argument here was passed in as a string, which luckily can be treated as a predicate with no parameter. Inside the chall setup, there was <code>print_flag</code> predicate requiring no argument and gave us the flag.
<code>https://pwning-en-logique-fa381af47302e838.d.imaginaryctf.org:443/greet?format=~@~n~w&amp;greeting=print_flag</code> would give us the flag.</p>
<h2 id="notactf">Notactf<a hidden class="anchor" aria-hidden="true" href="#notactf">#</a></h2>
<p>I think this would be a crypto-ish chall. We need to be a admin to solve this. And the web app check us by verify the <code>user-auth-token</code>. And by tamper this token, we will be admin :smiley:.
Because I was too lazy, so I though of tampering 1 character only. but really, any would work. The check only verify the decoded token without checking with the md5 hash. So I reversed the process of generating the token and tampered it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> AesEverywhere <span style="color:#f92672">import</span> aes256
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> xorCryptPy <span style="color:#f92672">import</span> xorCrypt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>authtoken <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;f3a5839ef3a582b9f3a5838df3a583b8f3a583aff3a5838cf3a5839df3a583a0f3a58393f3a582baf3a582a0f3a583aaf3a58399f3a5839cf3a58382f3a58383f3a58386f3a583a2f3a583bbf3a583aff3a583a4f3a5839df3a58382f3a583a0f3a582a0f3a583a0f3a5839df3a5839cf3a583acf3a58389f3a582bdf3a5838cf3a582bbf3a583a8f3a583a0f3a582bbf3a583a4f3a582bef3a5839bf3a58392f3a58382f3a58398f3a582a4f3a583bbf3a583b2f3a583b8f3a58399f3a583a2f3a58399f3a58399f3a582bef3a583b8f3a582bef3a582bdf3a58388f3a583bbf3a583a4f3a58383f3a583bbf3a583a0f3a5838ff3a582b2f3a58384f3a582bdf3a582b8f3a58380f3a583a2f3a58386f3a5838cf3a5838ff3a58386f3a5838ff3a583a2f3a5838ef3a583baf3a5839cf3a5839df3a583a2f3a583bdf3a583bcf3a58383f3a58393f3a583b8f3a582bbf3a582b2f3a583bcf3a582b6f3a582b6&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> base64 <span style="color:#f92672">import</span> decodebytes, encodebytes
</span></span><span style="display:flex;"><span>auth_decode <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(authtoken)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
</span></span><span style="display:flex;"><span>auth_decode <span style="color:#f92672">=</span> xorCrypt(auth_decode, <span style="color:#ae81ff">938123</span>)
</span></span><span style="display:flex;"><span>print(auth_decode)
</span></span><span style="display:flex;"><span>auth_decode <span style="color:#f92672">=</span> decodebytes(auth_decode<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span><span style="color:#75715e"># print(auth_decode)</span>
</span></span><span style="display:flex;"><span>gay <span style="color:#f92672">=</span> auth_decode[:<span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span>auth_decode <span style="color:#f92672">=</span> auth_decode[<span style="color:#ae81ff">16</span>:]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># print(auth_decode)</span>
</span></span><span style="display:flex;"><span>auth_decode <span style="color:#f92672">=</span> gay <span style="color:#f92672">+</span> auth_decode[:<span style="color:#ae81ff">16</span>] <span style="color:#f92672">+</span> (auth_decode[<span style="color:#ae81ff">16</span>]<span style="color:#f92672">^</span>ord(<span style="color:#e6db74">&#39;z&#39;</span>)<span style="color:#f92672">^</span>ord(<span style="color:#e6db74">&#39;a&#39;</span>))<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;big&#39;</span>) <span style="color:#f92672">+</span> auth_decode[<span style="color:#ae81ff">17</span>:]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># print(auth_decode)</span>
</span></span><span style="display:flex;"><span>auth_decode <span style="color:#f92672">=</span> encodebytes(auth_decode)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
</span></span><span style="display:flex;"><span>print(auth_decode)
</span></span><span style="display:flex;"><span>auth_decode <span style="color:#f92672">=</span> xorCrypt(auth_decode, <span style="color:#ae81ff">938123</span>)
</span></span><span style="display:flex;"><span>auth_decode <span style="color:#f92672">=</span> str(auth_decode)
</span></span><span style="display:flex;"><span>auth_decode <span style="color:#f92672">=</span> auth_decode<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)<span style="color:#f92672">.</span>hex()
</span></span><span style="display:flex;"><span>print(auth_decode)
</span></span></code></pre></div><p>A bit manual but well, it solved the challenge right :+1:.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">My New Hugo Site</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
